- name: samtools_quickcheck
  tags:
    - samtools
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t quickcheck tools/samtools.wdl bam="tests/input/test.bwa_aln_pe.chrY_chrM.bam"

- name: samtools_split
  tags:
    - samtools
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t split tools/samtools.wdl bam="tests/input/test.bam"
  files:
    - path: output/outputs.json
      contains:
      - test.1.bam
      - test.2.bam

- name: samtools_split_unaccounted
  tags:
    - samtools
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t split tools/samtools.wdl bam="tests/input/test.unaccounted_read.bam"
  exit_code: 1
  stderr:
    contains:
    - "There are reads present with bad or missing RG tags!"

- name: samtools_split_extra_RG
  tags:
    - samtools
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t split tools/samtools.wdl bam="tests/input/test.extra_RG.bam"
  exit_code: 1
  stderr:
    contains:
    - "No reads are in output BAM test.extra_RG.no_match.bam!"
    - "This is likely caused by malformed RG records."

- name: samtools_flagstat
  tags:
    - samtools
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t flagstat tools/samtools.wdl bam="tests/input/test.bwa_aln_pe.chrY_chrM.bam"
  files:
    - path: output/outputs.json
      contains:
      - test.bwa_aln_pe.chrY_chrM.flagstat.txt
      # contains:
      #   - "20000"
      #   - "0 + 0 secondary"
      #   - "20000 + 0 in total (QC-passed reads + QC-failed reads)"
      #   - "10000 + 0 read1"
      #   - "10000 + 0 read2"

- name: samtools_index
  tags:
    - samtools
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t index tools/samtools.wdl bam="tests/input/test.bwa_aln_pe.chrY_chrM.bam"
  files:
    - path: output/outputs.json
      contains:
      - test.bwa_aln_pe.chrY_chrM.bam.bai

- name: samtools_subsample
  tags:
    - samtools
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t subsample -i tests/tools/input_json/samtools_subsample.json tools/samtools.wdl
  files:
    - path: output/outputs.json
      contains:
      - test.sampled.bam

- name: samtools_merge
  tags:
    - samtools
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t merge -i tests/tools/input_json/samtools_merge.json tools/samtools.wdl
  files:
    - path: output/outputs.json
      contains:
      - test.bam

- name: samtools_addreplacerg
  tags:
    - samtools
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t addreplacerg tools/samtools.wdl bam="tests/input/test.bwa_aln_pe.chrY_chrM.bam" read_group_id="test"
  files:
    - path: output/outputs.json
      contains:
      - test.bwa_aln_pe.chrY_chrM.addreplacerg.bam

- name: samtools_collate
  tags:
    - samtools
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t collate tools/samtools.wdl bam="tests/input/test.bwa_aln_pe.chrY_chrM.bam"
  files:
    - path: output/outputs.json
      contains:
      - test.bwa_aln_pe.chrY_chrM.collated.bam

- name: samtools_bam_to_fastq
  tags:
    - samtools
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t bam_to_fastq tools/samtools.wdl bam="tests/input/test.bwa_aln_pe.chrY_chrM.bam" retain_collated_bam=true
  files:
    - path: output/outputs.json
      contains:
      - test.bwa_aln_pe.chrY_chrM.collated.bam
      - test.bwa_aln_pe.chrY_chrM.R1.fastq.gz
      - test.bwa_aln_pe.chrY_chrM.R2.fastq.gz

- name: samtools_faidx
  tags:
    - samtools
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t faidx tools/samtools.wdl fasta="tests/input/test.fa"
  files:
    - path: output/outputs.json
      contains:
      - test.fa.fai
