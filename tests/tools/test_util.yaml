- name: download
  tags:
    - util
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -i tests/tools/input_json/util_download.json -t download tools/util.wdl
  stdout:
    contains_regex:
      - '"download.downloaded_file": ".*output/out/downloaded_file/license.txt"'
  files:
    - path: output/out/downloaded_file/license.txt
      md5sum: cf3575bd84ab3151c7e9700b5f1a9746
      contains:
        - "MIT License"

- name: split_string
  tags:
    - util
  command: >-
        ./developer_scripts/run_sprocket_or_miniwdl.sh -t split_string tools/util.wdl string="rg1 , rg2"
  stdout:
    contains:
      - "rg1"
      - "rg2"
    must_not_contain:
      - "rg1 , rg2"

- name: calc_gene_lengths
  tags:
    - util
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t calc_gene_lengths tools/util.wdl gtf="tests/input/gencode.v31.chrY_chrM.gtf.gz"
  files:
    - path: output/out/gene_lengths/gencode.v31.chrY_chrM.genelengths.txt
      contains:
        - "AL954722.1"

- name: compression_integrity
  tags:
    - util
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t compression_integrity tools/util.wdl bgzipped_file="tests/input/test.bwa_aln_pe.chrY_chrM.bam"

# TODO: This does not test that the record was properly added to the header.
- name: add_to_bam_header
  tags:
    - util
  command: >-
      ./developer_scripts/run_sprocket_or_miniwdl.sh -t add_to_bam_header tools/util.wdl bam="tests/input/test.bwa_aln_pe.chrY_chrM.bam" additional_header="@RG	ID:3"
  files:
    - path: "output/out/reheadered_bam/test.bwa_aln_pe.chrY_chrM.reheader.bam"

- name: unpack_tarball
  tags:
    - util
  command: >-
      ./developer_scripts/run_sprocket_or_miniwdl.sh -t unpack_tarball tools/util.wdl tarball="tests/input/test.tar.gz"
  files:
    - path: "output/out/tarball_contents/0/a"
    - path: "output/out/tarball_contents/1/b"

- name: make_coverage_regions_bed
  tags:
    - util
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t make_coverage_regions_bed tools/util.wdl gtf="tests/input/gencode.v31.chrY_chrM.gtf.gz" feature_type="exon"
  files:
    - path: "output/out/bed/gencode.v31.chrY_chrM.exon.bed"

- name: global_phred_scores
  tags:
    - util
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t global_phred_scores tools/util.wdl bam="tests/input/test.bwa_aln_pe.chrY_chrM.bam"
  files:
    - path: "output/out/phred_scores/test.bwa_aln_pe.chrY_chrM.global_PHRED_scores.tsv"

- name: split_fastq
  tags:
    - util
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t split_fastq tools/util.wdl fastq="tests/input/test_R1.fq.gz" prefix="test.R1."
  files:
    - path: "output/out/fastqs/0/test.R1.000000.fastq.gz"