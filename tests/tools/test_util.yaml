- name: download
  tags:
    - util
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -i tests/tools/input_json/util_download.json -t download tools/util.wdl
  files:
    - path: output/outputs.json
      contains:
      - license.txt
      # md5sum: cf3575bd84ab3151c7e9700b5f1a9746
      # contains:
      #   - "MIT License"

- name: split_string
  tags:
    - util
  command: >-
        ./developer_scripts/run_sprocket_or_miniwdl.sh -t split_string -i tests/tools/input_json/util_split_string.json tools/util.wdl
  stdout:
    contains:
      - "rg1"
      - "rg2"
    must_not_contain:
      - "rg1 , rg2"

- name: calc_gene_lengths
  tags:
    - util
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t calc_gene_lengths tools/util.wdl gtf="tests/input/gencode.v31.chrY_chrM.gtf.gz"
  files:
    - path: output/outputs.json
      contains:
      - gencode.v31.chrY_chrM.genelengths.txt
      # contains:
      #   - "AL954722.1"

- name: compression_integrity
  tags:
    - util
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t compression_integrity tools/util.wdl bgzipped_file="tests/input/test.bwa_aln_pe.chrY_chrM.bam"

# TODO: This does not test that the record was properly added to the header.
- name: add_to_bam_header
  tags:
    - util
  command: >-
      ./developer_scripts/run_sprocket_or_miniwdl.sh -t add_to_bam_header -i tests/tools/input_json/util_add_to_bam_header.json tools/util.wdl
  files:
    - path: output/outputs.json
      contains:
      - test.bwa_aln_pe.chrY_chrM.reheader.bam

- name: unpack_tarball
  tags:
    - util
  command: >-
      ./developer_scripts/run_sprocket_or_miniwdl.sh -t unpack_tarball tools/util.wdl tarball="tests/input/test.tar.gz"
  files:
    - path: output/outputs.json
      contains:
      - test_file_a
      - test_file_b

- name: make_coverage_regions_bed
  tags:
    - util
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t make_coverage_regions_bed tools/util.wdl gtf="tests/input/gencode.v31.chrY_chrM.gtf.gz" feature_type="exon"
  files:
    - path: output/outputs.json
      contains:
      - gencode.v31.chrY_chrM.exon.bed

- name: global_phred_scores
  tags:
    - util
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t global_phred_scores tools/util.wdl bam="tests/input/test.bwa_aln_pe.chrY_chrM.bam"
  files:
    - path: output/outputs.json
      contains:
      - test.bwa_aln_pe.chrY_chrM.global_PHRED_scores.tsv

- name: split_fastq
  tags:
    - util
  command: >-
    ./developer_scripts/run_sprocket_or_miniwdl.sh -t split_fastq tools/util.wdl fastq="tests/input/test_R1.fq.gz" prefix="test.R1."
  files:
    - path: output/outputs.json
      contains:
      - test.R1.000000.fastq.gz